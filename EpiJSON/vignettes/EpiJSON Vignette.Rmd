---
title: "EpiJSON Vignette"
author: "Team Hackout2: Thomas Finnae; Andy South; Ellie Sherrard-Smith; Ana Bento"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

This is a demonstration of the package EpiJSON and how you can use the functions provided to change the format of data for use in different analyses.

# Validation

Demonstating how we can go from a JSON to dF to obkData

```{r}
  # load the required libraries

library(devtools)
library(OutbreakTools)
library(sp)
library(HistData)

  # Load the EpiJSON library

install_github("Hackout2/format/EpiJSON")
library(EpiJSON)


# These are example data in obkData format
data(ToyOutbreak) 

# These are example data in data.frame format

#
##
###
####Example data.frame 1
###
##
#

data(Snow.deaths)
# Adding some dates, pumps, some genders 

simulated <- Snow.deaths
simulated$gender <- c("male","female")[(runif(nrow(simulated))>0.5) +1]
simulated$date <- as.POSIXct("1854-04-05") + rnorm(nrow(simulated), 10) * 86400
simulated$pump <- ceiling(runif(nrow(simulated)) * 5)

exampledata1<-head(simulated)


#
##
###
####Example data.frame 2
###
##
#

exampledata2<- data.frame(id=c("A","B","3D","4d"),
                 name=c("tom","andy","ellie","Ana"),
                 dob=c("1984-03-14","1985-11-13","1987-06-16","1987-06-16"),
                 gender=c("male","male","female","female"),
                 rec1contact=c(2,1,5,1),
                 rec1dateStart=c("2014-12-28","2014-12-29","2015-01-03","2015-01-08"),
                 rec1dateEnd=c("2014-12-30","2015-01-04","2015-01-07","2015-01-14"),
                 rec1risk=c("high","high","low","high"),  
                 rec1temp=c(39,41,41,39),
                 rec2contact=c(4,1,1,1),
                 rec2dateStart=c("2015-01-02","2015-01-12","2015-01-09","2015-01-09"),
                 rec2risk=c("high","low","high","low"),stringsAsFactors=FALSE)


#############################################
## Transition 1: data.frame to JSON format ##
#############################################

# Use the EpiJSON package to convert a data.frame object into a JSON object:


eg1 <- as.ejObject(exampledata1, recordAttributes = c("gender"),
   	eventDefinitions = list(defineEjEvent(dateStart="date", dateEnd="date", name=NA, location=list(x="x", y="y", proj4string=""), attributes="pump")),
 		metadata=list())
#
##
### Convert this into a JSON character string
##
#

eg1JSON<-r2epiJSON(eg1)

#
##
### Convert this to a JSON object in R format
##
#

eg1JSONobj <- epiJSON2r(eg1JSON)


eg2 <- as.ejObject(exampledata2, recordAttributes = c("name","dob","gender"),
     eventDefinitions = list(defineEjEvent(name="rec1contact",dateStart="rec1dateStart", dateEnd="rec1dateEnd", attributes=list("rec1risk","rec1temp")),
                             defineEjEvent(name="rec2contact",dateStart="rec2dateStart", dateEnd="rec2dateStart", attributes="rec2risk")),
 		metadata=list())
#
##
### Convert this into a JSON character string
##
#

eg2JSON<-r2epiJSON(eg2)

#
##
### Convert this to a JSON object in R format
##
#

eg2JSONobj <- epiJSON2r(eg2JSON)

####################################################
## Transition 2: JSON object to data.frame format ##
####################################################

# Use the EpiJSON package to convert a JSON object into a data.frame object:



####################################################
## Transition 3: JSON object to obkData format    ##
####################################################

# Use the EpiJSON package to convert a JSON object into an obkData object:
data(ToyOutbreak)
x=subset(ToyOutbreak,1)
 
as.ejObject.obkData(x,metadata=list())

```

## Figures

The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold'}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
