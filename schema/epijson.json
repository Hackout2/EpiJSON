{
    "id": "https://raw.githubusercontent.com/Hackout2/EpiJSON/master/schema/epijson.json",
    "$schema":"http://json-schema.org/draft-04/schema#",
    "title":"EpiJSON Schema V0.7",
    "description":"Epidemiological data in JSON format",
    "definitions":{
                "stringAttribute": {
            "properties":{
                "name":{
                    "description":"The name of the attribute",
                    "type":"string"
                },
                "type":{
                    "description":"The type of the attribute",
                    "type":"string",
                    "pattern": "string"
                },
                "value":{
                    "description":"The actual value of the attribute",
                    "type": "string"
                }
            },
            "required": [ "name", "type", "value" ],
            "additionalProperties": false        
        },
        "numberAttribute": {
            "properties":{
                "name":{
                    "description":"The name of the attribute",
                    "type":"string"
                },
                "type":{
                    "description":"The type of the attribute",
                    "type":"string",
                    "pattern":"number"
                },
                "value":{
                    "description":"The actual value of the attribute",
                    "type":"number"
                },
                "units":{
                    "description":"A string containing the units name, preferably compatible with UDUNITS2",
                    "type":"string"
                }
            },
            "required": [ "name", "type", "value" ],
            "additionalProperties": false
        },
        "integerAttribute": {
            "properties":{
                "name":{
                    "description":"The name of the attribute",
                    "type":"string"
                },
                "type":{
                    "description":"The type of the attribute",
                    "type":"string",
                    "pattern":"integer"
                },
                "value":{
                    "description":"The actual value of the attribute",
                    "type":"integer"
                },
                "units":{
                    "description":"A string containing the units name, preferably compatible with UDUNITS2",
                    "type":"string"
                }
            },
            "required": [ "name", "type", "value" ],
            "additionalProperties": false
        },
        "booleanAttribute": {
            "properties":{
                "name":{
                    "description":"The name of the attribute",
                    "type":"string"
                },
                "type":{
                    "description":"The type of the attribute",
                    "type":"string",
                    "pattern":"boolean"
                },
                "value":{
                    "description":"The actual value of the attribute",
                    "type":"boolean"
                }
            },
            "required": [ "name", "type", "value" ],
            "additionalProperties": false
        },
        "dateAttribute": {
            "properties":{
                "name":{
                    "description":"The name of the attribute",
                    "type":"string"
                },
                "type":{
                    "description":"The type of the attribute",
                    "type":"string",
                    "pattern":"string"
                },
                "value":{
                    "description":"The actual value of the attribute",
                    "type":"string",
                    "format": "date-time"
                }
            },
            "required": [ "name", "type", "value" ],
            "additionalProperties": false
        },
        "locationAttribute": {
            "properties":{
                "name":{
                    "description":"The name of the attribute",
                    "type":"string"
                },
                "type":{
                    "description":"The type of the attribute",
                    "type":"string",
                    "pattern":"location"
                },
                "value":{
                    "description":"The actual value of the attribute",
                    "type":"object",
                    "oneOf": [
                        { "$ref":"https://raw.githubusercontent.com/Hackout2/EpiJSON/master/schema/geojson/geojson.json" }
                    ]
                }
            },
            "required": [ "name", "type", "value" ],
            "additionalProperties": false
        },
        "base64Attribute": {
            "properties":{
                "name":{
                    "description":"The name of the attribute",
                    "type":"string"
                },
                "type":{
                    "description":"The type of the attribute",
                    "type":"string",
                    "pattern": "base64"
                },
                "value":{
                    "description":"The actual value of the attribute",
                    "type": "string"
                }
            },
            "required": [ "name", "type", "value" ],
            "additionalProperties": false
        },                
        "attribute":{
            "description":"Attribute of the parent",
            "type":"object",
            "oneOf":[
                    { "$ref": "#/definitions/stringAttribute" },
                    { "$ref": "#/definitions/numberAttribute" }
                ]
        },
        "event":{
            "description":"An incident that occurred to the parent record",
            "type":"object",
            "properties":{
                "id":{
                    "description": "An integer event number (counts from zero)",
                    "type": "integer",
                    "minimum": 0   
                },
                "name":{
                    "description":"The event name",
                    "type":"string"
                },
                "date":{
                    "description":"The date and time on which the event occured (in ISO 8601 format)",
                    "type":"string",
                    "format":"date-time"
                },
                "location":{
                    "description":"The place where the event happened (MUST be valid GeoJSON object)",
                    "type": "object",
                    "oneOf": [
                        { "$ref":"https://raw.githubusercontent.com/Hackout2/EpiJSON/master/schema/geojson/geojson.json" }
                    ]
                },
                "attributes":{
                    "description":"Attributes of the events",
                    "type":"array",
                    "items":{
                        "$ref":"#/definitions/attribute"
                    },
                    "uniqueItems": true
                }
            },
            "additionalProperties": false,
            "anyOf": [
                { "required": ["id", "name", "date", "location"] },
                { "required": ["id", "name", "date"] },
                { "required": ["id", "name", "location"] }
            ]
        },
        "record":{
            "description":"A record for an entity (e.g. a person, geographic locality, etc)",
            "type":"object",
            "properties":{
                "id":{
                    "description": "A unique record identifier (counts from zero)",
                    "type": "integer",
                    "minimum": 0   
                },
                "attributes":{
                    "description":"Attributes for this record",
                    "type":"array",
                    "items":{
                        "$ref":"#/definitions/attribute"
                    }
                },
                "events": {
                    "type":"array",
                    "items":{
                        "$ref":"#/definitions/event"
                    }
                }   
            },
            "additionalProperties": false,
            "anyOf": [
                { "required": ["id", "attributes"] },
                { "required": ["id", "events"] }
            ]
        }
    },
    "type":"object",
    "properties":{
        "metadata":{
            "description":"Attributes for this dataset",
            "type":"array",
            "items":{
                "$ref":"#/definitions/attribute"
            }
        },
        "records":{
            "type":"array",
            "items":{
                "$ref":"#/definitions/record"
            }
        }
    },
    "additionalProperties": false,
    "required": ["metadata", "records"]
}